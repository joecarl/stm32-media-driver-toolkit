# STM32 MEDIA DRIVER TOOLKIT

This package provides a toolkit for developing applications with multimedia features using STM32 boards.
It implements a VGA driver, a basic primitive drawing library, a very basic audio driver and a basic USB input device driver.

This is an adaptation of an old project that I developed in 2014.

IMPORTANT: The adaptation is still ongoing...

## VGA DRIVER

The driver generates a VGA signal with 256 colors RGB 2-3-3

A minimal DAC is needed to convert the 8 bit signal to the 3 channel VGA analog signals. This DAC can be easily built with only resistors.
The following picture describes how to build the DAC and how to connect it to the VGA adapter:

<img alt="DAC circuit schematics" src="./docs/dac-schematics.svg" width="400" style=" border-radius: 5px">

By default, the video output on the board uses the following pins:

- B0 -> PC8
- B1 -> PC9
- B2 -> PC10
- G0 -> PC11
- G1 -> PC12
- G2 -> PC13
- R0 -> PC14
- R1 -> PC15

But in the future this will be a configurable option.

If you don't want to build the DAC, it is still possible to generate the output without it, but the color combinations will be reduced to 8.

## Example

Here is a basic example which demonstrates how to initialize the video driver.

```c

#include <stdio.h>

#include <stm32f4xx.h>
#include "libs/graphics.h"
#include "libs/text.h"


void example(void) {

    GRAPHICS_InitTypeDef graphicsCfg = {
        .useHardwareAcceleration = true,
        .useSDRAM = false,
        .mainCtxHeight = 200,
        .mainCtxWidth = 320,
        .videoDriver = VIDEO_DRIVER_VGA,
    };

    GRAPHICS_Init(&graphicsCfg);

    while (1) {

        ClearBitmap(0x00);
        
        DrawText("Hello world!", 10, 10, 0xFF);
        
        WaitForVSync();
        
        SwapContextBuffers();

    }

}

```

## How to run the examples

1. Create a new STM32CubeIDE project. Make sure the following peripherals are configured:

- GPIO
- NVIC
- RCC
- SYS
- CRC
- USB_HS & USB_HOST (optional)

1. If possible disable all the other peripherals configuration.

1. If you want USB support please make sure the SysTick interrupt priority is higher than the OTG_HS interrupt (lower value means higher priority).

1. Open a terminal and navigate to the project Middleware folder, once there `git clone` this repo.

1. Go to project properties and make sure the `USE_FULL_LL_DRIVER` definition is set.

1. Add the include folders to the include directories.

1. Open the project folder and copy the dependencies.

1. Edit main file and add the following lines:

```c

#include "examples.h"

//...

void main(void) {

    //...
    //Peripherals auto generated code
    //Comment out the MX_USB_HOST_Init function
    //...
    term_demo();
    //...
    //Autogenerated main loop
    //...
    
}

```
